<!DOCTYPE html>
<html>
  <head>
      <link rel="stylesheet" href="./src/css/app.css">
      <script src="./style/uikit/js/uikit.min.js"></script>
      <script src="./style/uikit/js/uikit-icons.js"></script>
  </head>
  <body>
    <div class="uk-offcanvas-content">

        <!-- The whole page content goes here -->

        <a uk-icon="menu" type="button" uk-toggle="target: #offcanvas-usage"></a>


        <div id="offcanvas-usage" uk-offcanvas>
            <div class="uk-offcanvas-bar">

                <button class="uk-offcanvas-close" type="button" uk-close></button>
				<a href="./index.html">Preferred Names</a>
        		<a href="./settings.html">Settings</a>

            </div>
        </div>

    </div>
    <div class="uk-container">
      	<form id="settings-form ">
			<h4>FreshGrade Credentials</h4>
			<div>
				<label>FreshGrade Username</label>
				<input class="setting-input uk-input" name="fgUserName" id="fg-user-name" />
			</div>
			<div>
				<label>FreshGrade Password</label>
				<input class="setting-input uk-input" type="password" name="fgPassword" id="fg-user-password" />
			</div>
			<h4>Path to CSV Files</h4>
			<div>
				<label>Path to CSVs</label>
				<input class="setting-input uk-input" name="filePath" id="file-path" disabled />
				<span uk-icon="folder"></span><a onclick="setFilePath()" >Change file path</a>
			</div>
		
			<input type="Submit" class="uk-button uk-button-primary uk-margin" id="submit-settings" value="Save Settings" />
      	</form>
    </div>

  </body>

  <script>
    const {shell} = require('electron');
    var ipc = require("electron").ipcRenderer;
    window.$ = window.jQuery = require('./bower_components/jquery/dist/jquery.js');
	
	$(function(){
      	ipc.send('get-settings');

    });

    $("#settings-form").submit(function(e) {
		console.log(e);
      e.preventDefault();
      var data = objectifyForm($( this ).serializeArray());
      ipc.send('set-settings', data);
    });


    function objectifyForm(formArray) {//serialize data function
      var returnArray = {};
      for (var i = 0; i < formArray.length; i++){
        returnArray[formArray[i]['name']] = formArray[i]['value'];
      }
      return returnArray;
	}
	
    function setFilePath(){
      ipc.send('selectDirectory');
    }

    ipc.on('set-file-path', function(event, arg) {
      $.each(arg, function(key, value) {
        console.log(arg);
        $('#file-path').val(arg);
      });
      // $('#settings-form').click();
    });

    ipc.on('settings', function(event, arg) {
      console.log(arg);
      var $inputs = $('.setting-input');
      $.each(arg, function(key, value) {
        $inputs.filter(function() {
          return key == this.name;
        }).val(value);
      });
	});
  </script>

</html>
